/**
* QUẢN LÝ CỬA HÀNG TIVI
* Nguyễn Tuấn Vũ - DTH206069 - DH21TH2
*/

CREATE DATABASE QLCH_TIVI;
USE QLCH_TIVI;

CREATE TABLE CHUC_VU (
	MA_CV CHAR(10) NOT NULL,
	TEN_CV NVARCHAR(20) NOT NULL,
	CAP_DO INT NOT NULL,
	PRIMARY KEY(MA_CV)
);

CREATE TABLE NHAN_VIEN (
	MA_NV CHAR(10) NOT NULL,
	TEN_NV NVARCHAR(100) NOT NULL,
	DTHOAI VARCHAR(10) NOT NULL,
	EMAIL VARCHAR(50) CHECK(EMAIL LIKE '%@%' AND EMAIL LIKE '%[^ ]%'),
	PRIMARY KEY(MA_NV)
);

CREATE TABLE TAI_KHOAN (
	MA_TK CHAR(10) NOT NULL,
	TEN_DN CHAR(20) NOT NULL,
	MK_DN CHAR(20) NOT NULL,
	MA_NV CHAR(10) NOT NULL,
	MA_CV CHAR(10) NOT NULL,
	PRIMARY KEY(MA_TK)
);

CREATE TABLE NHA_CUNG_CAP (
	MA_NCC CHAR(10) NOT NULL,
	TEN_NCC NVARCHAR(20) NOT NULL,
	DTHOAI VARCHAR(10) NOT NULL,
	DIACHI NVARCHAR(50) NOT NULL,
	PRIMARY KEY(MA_NCC)
);

CREATE TABLE KHACH_HANG (
	MA_KH CHAR(10) NOT NULL,
	TEN_KH NVARCHAR(100) NOT NULL,
	DTHOAI VARCHAR(10) NOT NULL,
	EMAIL VARCHAR(50) CHECK(EMAIL LIKE '%@%' AND EMAIL LIKE '%[^ ]%'),
	DIACHI NVARCHAR(50) NOT NULL,
	PRIMARY KEY(MA_KH)
);

CREATE TABLE TIVI (
	MA_TV CHAR(10) NOT NULL,
	TEN_TV CHAR(150) NOT NULL,
	LOAI CHAR(20) NOT NULL,
	NAMRAMAT CHAR(4) NOT NULL,
	GOIBAOHANH NVARCHAR(20) NOT NULL,
	KICHTHUOC CHAR(30) NOT NULL,
	KHOILUONG CHAR(30) NOT NULL,
	DOPHANGIAI VARCHAR(20) NOT NULL,
	DONGIA CHAR(15) NOT NULL,
	XUATXU NCHAR(20) NOT NULL,
	MA_NCC CHAR(10) NOT NULL,
	PRIMARY KEY(MA_TV)
);

CREATE TABLE HOA_DON (
	MA_HD CHAR(10) NOT NULL,
	NGAY_LAP CHAR(15) NOT NULL,
	MA_NV CHAR(10) NOT NULL,
	MA_KH CHAR(10) NOT NULL,
    PRIMARY KEY(MA_HD)
);

CREATE TABLE CHI_TIET_HD (
	MA_CTHD CHAR(10) NOT NULL,
	MA_TV CHAR(10) NOT NULL,
	SOLUONGTV TINYINT NOT NULL,
	THANHTIEN INT NOT NULL,
	MA_HD CHAR(10) NOT NULL,
	TONGTIEN INT NOT NULL,
    PRIMARY KEY(MA_CTHD)
);

--RÀNG BUỘC KHOÁ NGOẠI
ALTER TABLE TAI_KHOAN ADD CONSTRAINT fk_manv FOREIGN KEY (MA_NV) REFERENCES NHAN_VIEN(MA_NV);
ALTER TABLE TAI_KHOAN ADD CONSTRAINT fk_macv FOREIGN KEY (MA_CV) REFERENCES CHUC_VU(MA_CV);
ALTER TABLE TIVI ADD CONSTRAINT fk_mancc FOREIGN KEY (MA_NCC) REFERENCES NHA_CUNG_CAP(MA_NCC);
ALTER TABLE HOA_DON ADD CONSTRAINT fk_manv FOREIGN KEY (MA_NV) REFERENCES NHAN_VIEN(MA_NV);
ALTER TABLE HOA_DON ADD CONSTRAINT fk_makh FOREIGN KEY (MA_KH) REFERENCES KHACH_HANG(MA_KH);
ALTER TABLE CHI_TIET_HD ADD CONSTRAINT fk_matv FOREIGN KEY (MA_TV) REFERENCES TIVI(MA_TV);
ALTER TABLE CHI_TIET_HD ADD CONSTRAINT fk_mahd FOREIGN KEY (MA_HD) REFERENCES HOA_DON(MA_HD);

--CHUC_VU(MA_CV, TEN_CV, CAP_DO)
INSERT INTO CHUC_VU VALUES('AC1001', N'Admin', '1');
INSERT INTO CHUC_VU VALUES('AC2002', N'Manager', '2');
INSERT INTO CHUC_VU VALUES('AC3003', N'Staff', '3');
SELECT * FROM CHUC_VU;

--NHAN_VIEN(MA_NV, TEN_NV, DTHOAI, EMAIL)
INSERT INTO NHAN_VIEN VALUES('NV7777', N'Nguyễn Tuấn Vũ', '0358802875', 'ntvu_ad7v_52@gmail.com');
INSERT INTO NHAN_VIEN VALUES('NV1396', N'Nguyễn Tuấn Anh', '0123456789', 'ntanh_tv777@gmail.com');
INSERT INTO NHAN_VIEN VALUES('NV2476', N'Trần Vi Nam', '0321654987', 'tvnam_tv777@gmail.com');
INSERT INTO NHAN_VIEN VALUES('NV3522', N'Lê Khánh Phong', '0918273645', 'lkphong_tv777@gmail.com');
SELECT * FROM NHAN_VIEN;

--TAI_KHOAN(MA_TK, TEN_DN, MK_DN, MA_NV, MA_CV)
INSERT INTO TAI_KHOAN VALUES('TK9001', 'Admin', 'admin', 'NV7777', 'AC1001');
INSERT INTO TAI_KHOAN VALUES('TK9002', 'Manager', 'manager', 'NV1396', 'AC2002');
INSERT INTO TAI_KHOAN VALUES('TK9003', 'lkphong', 'staff', 'NV3522', 'AC3003');
INSERT INTO TAI_KHOAN VALUES('TK9004', 'tvnam', 'staff', 'NV2476', 'AC3003');
SELECT * FROM TAI_KHOAN;

--NHA_CUNG_CAP(MA_NCC, TEN_NCC, DTHOAI, DIACHI)
INSERT INTO NHA_CUNG_CAP VALUES('2164', 'Samsung', '333999777', N'Hàn Quốc');
INSERT INTO NHA_CUNG_CAP VALUES('2356', 'Sony', '222888555', N'Nhật Bản');
INSERT INTO NHA_CUNG_CAP VALUES('4572', 'Google', '111777444', N'Hoa Kỳ');
INSERT INTO NHA_CUNG_CAP VALUES('8639', 'Coocaa', '444777999', N'Indonesia');
SELECT * FROM NHA_CUNG_CAP;
	
--TIVI(MA_TV, TEN_TV, LOAI, NAMRAMAT, GOIBAOHANH, KICHTHUOC, KHOILUONG, DOPHANGIAI, DONGIA, XUATXU, MA_NCC)
INSERT INTO TIVI VALUES('823945', 'Smart Tivi Samsung QLED 4K 75 Inch QA75Q60B', 'Smart Tivi QLED', '2022', '24 Tháng (2 năm)', '72', '21', 'Ultra HD (4K)', '32490000', N'Hàn Quốc', '2164');
INSERT INTO TIVI VALUES('209874', 'Google Tivi OLED Sony 4K 77 Inch XR-77A80K', 'Google TV OLED', '2022', '36 Tháng (3 năm)', '75', '23', 'Ultra HD (4K)', '90900000', N'Nhật Bản', '2356');
INSERT INTO TIVI VALUES('148903', 'Smart Tivi HD Coocaa 32 Inch 32S3U', 'Smart LED', '2021', '24 Tháng (2 năm)', '32', '9.2', 'HD', '5990000', N'Indonesia', '8639');
SELECT * FROM TIVI;

--KHACH_HANG(MA_KH, TEN_KH, DTHOAI, EMAIL, DIACHI)
INSERT INTO KHACH_HANG VALUES('133227', N'Nguyễn Trần Trúc Phương', '0234567891', 'nttphuongh@gmail.com', N'TP Hồ Chí Minh');
INSERT INTO KHACH_HANG VALUES('342463', N'Trần Trung Chí Hướng', '0234567891', 'ttchuong@gmail.com', N'TP Cần Thơ');
SELECT * FROM KHACH_HANG;

--HOA_DON(MA_HD, NGAY_LAP, MA_NV, MA_KH)
INSERT INTO HOA_DON VALUES('133227', '25/11/2022', 'NV1396', '133227');
INSERT INTO HOA_DON VALUES('342463', '24/11/2022', 'NV2476', '342463');
SELECT * FROM HOA_DON;

--CHI_TIET_HD(MA_CTHD, MA_TV, SOLUONGTV, THANHTIEN, MA_HD, TONGTIEN)
INSERT INTO CHI_TIET_HD VALUES('723422', '823945', '2', '64980000', '133227', '64980000');
INSERT INTO CHI_TIET_HD VALUES('237023', '209874', '1', '90900000', '342463', '90900000');
SELECT * FROM CHI_TIET_HD;
GO

/* STORED PROCEDURE */
CREATE PROC SP_LOGIN
@UNAME CHAR(20),
@UPASS CHAR(20)
AS
BEGIN
	SELECT * FROM TAI_KHOAN WHERE TEN_DN = @UNAME AND MK_DN = @UPASS
END

-- VD: EXEC SP_LOGIN Admin, admin
